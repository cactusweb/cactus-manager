<app-header 
    (onSearch)="pipeData.search = $event"
    (onFilter)="pipeData.filter = $event"
    (onDataUpdate)="getLicenses(true)"
    (onOpenLicenseForm)="popupType = 'licenseForm'"
></app-header>

<div class="window licenses">
    <table class="table-primary">
        <thead>
            <tr>
                <th>
                    <th-sortable label="Nickname"
                        (onChangeSort)="pipeData.sortNickname = $event; justMap()"
                    ></th-sortable>
                </th>
                <th>License key</th>
                <th>Type</th>
                <th>
                    <th-sortable label="Renewal date"
                        (onChangeSort)="pipeData.sortRenewDate = $event; justMap()"
                        
                    ></th-sortable>
                </th>
                <th>Used</th>
                <th>Actions</th>
            </tr>
        </thead>
    </table>
<!-- {{pipeData.sortNickname}} -->
    <span class="table-primary-hr"></span>
    
    <cdk-virtual-scroll-viewport class="custom-scroll" itemSize="30"> 
        <table class="table-primary">
            <app-license-row *cdkVirtualFor="let license of licenses
                | search : pipeParams.search : pipeData.search
                | filter : pipeParams.filter : pipeData.filter
                | sort : pipeParams.sortNickname : pipeData.sortNickname
                | sort : pipeParams.sortRenewDate : pipeData.sortRenewDate
                , let i = index, trackBy: trackByFn
                " 
                [license]="license"
                (onDelete)="onDeleteLicense($event)"
                (onRenew)="onRenewLicense($event)"
                (onView)="onViewLicense($event)"
                (onEdit)="popupType = 'licenseForm'; popupLicenseId = $event"
            ></app-license-row>
        </table>
    </cdk-virtual-scroll-viewport>
    
</div>



<div class="overlay" *ngIf="popupType == 'licenseViewing' && popupLicenseId">
    <div class="artboard" (click)="popupType = null; popupLicenseId = null"></div>
    <app-license-viewing style="width: 720px"
        [license]="getLicenseById(popupLicenseId) || licenses[0]"
        (onClose)="popupType = null; popupLicenseId = null"
    ></app-license-viewing>
</div>


<div class="overlay" *ngIf="popupType == 'licenseForm'">
    <div class="artboard" (click)="popupType = null; popupLicenseId = null"></div>
    <app-license-form style="width: 480px"
        [license]="popupLicenseId ? getLicenseById(popupLicenseId) : null"
        (onClose)="popupType = null; popupLicenseId = null"
        (onPost)="onPostLicense($event)"
    ></app-license-form>
</div>

